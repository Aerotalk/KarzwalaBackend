generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  Int                  @id @default(autoincrement())
  name                String?
  email               String?              @unique
  phone               String               @unique
  password            String?
  dob                 DateTime?
  gender              Gender?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  role                UserRole             @default(CUSTOMER)
  verificationStatus  VerificationStatus   @default(PENDING)
  phoneVerified       Boolean              @default(false)
  phoneVerifiedAt     DateTime?
  customUserId        String?              @unique
  attributedPartnerId Int?
  attributionDate     DateTime?
  attributionType     AttributionType?
  profileType         ProfileType?
  aadhaarVerification AadhaarVerification?
  address             AddressDetail?
  attributionLogs     AttributionLog[]
  business            BusinessDetail?
  employment          EmploymentDetail?
  loans               Loan[]
  loanApplications    LoanApplication[]
  otps                OtpVerification[]
  panVerification     PanVerification?
  partnerStatus       PartnerStatus?
  attributedPartner   Partner?             @relation(fields: [attributedPartnerId], references: [id])
  documents           UserDocument[]
  status              UserDocumentStatus?
  locations           UserLocation[]
}

model BusinessDetail {
  id           Int      @id @default(autoincrement())
  userId       Int      @unique
  firmName     String
  gstNumber    String?
  tradeLicense String?
  companyPan   String?
  address      String?
  city         String?
  state        String?
  pincode      String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id])
}

model PartnerStatus {
  id         Int      @id @default(autoincrement())
  userId     Int      @unique
  status     String   @default("PENDING")
  remarks    String?
  approvedBy Int?
  secretKey  String?
  updatedAt  DateTime @updatedAt
  user       User     @relation(fields: [userId], references: [id])
}

model Partner {
  id              Int               @id @default(autoincrement())
  name            String
  email           String?           @unique
  phone           String            @unique
  password        String?
  partnerType     PartnerType
  status          PartnerStatusType @default(PENDING)
  gstNumber       String?
  panNumber       String?
  address         String?
  city            String?
  state           String?
  pincode         String?
  secretKey       String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  firmName        String?
  attributionLogs AttributionLog[]
  users           User[]
}

model AttributionLog {
  id        Int      @id @default(autoincrement())
  userId    Int?
  partnerId Int
  action    String
  metadata  String?
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  partner   Partner  @relation(fields: [partnerId], references: [id])
  user      User?    @relation(fields: [userId], references: [id])
}

model AadhaarVerification {
  id            Int       @id @default(autoincrement())
  aadhaarNumber String    @unique
  verified      Boolean   @default(false)
  verifiedAt    DateTime?
  userId        Int       @unique
  user          User      @relation(fields: [userId], references: [id])
}

model PanVerification {
  id         Int       @id @default(autoincrement())
  panNumber  String    @unique
  verified   Boolean   @default(false)
  verifiedAt DateTime?
  userId     Int       @unique
  user       User      @relation(fields: [userId], references: [id])
}

model EmploymentDetail {
  id               Int               @id @default(autoincrement())
  stability        JobStability?
  userId           Int               @unique
  companyAddress   String?
  monthlyIncome    Float?
  createdAt        DateTime          @default(now())
  employerName     String?
  updatedAt        DateTime          @updatedAt
  employmentType   EmploymentType
  user             User              @relation(fields: [userId], references: [id])
  loanApplications LoanApplication[] @relation("EmploymentLoanApplications")
}

model AddressDetail {
  id                  Int          @id @default(autoincrement())
  city                String?
  state               String?
  postalCode          String?
  userId              Int          @unique
  currentAddress      String?
  currentAddressProof String?
  currentAddressType  AddressType?
  permanentAddress    String?
  user                User         @relation(fields: [userId], references: [id])
}

model OtpVerification {
  id        Int      @id @default(autoincrement())
  otpCode   String
  expiresAt DateTime
  verified  Boolean  @default(false)
  userId    Int
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model Otp {
  id        Int      @id @default(autoincrement())
  phone     String
  code      String
  expiresAt DateTime
  verified  Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([phone, expiresAt])
}

model Loan {
  id            Int        @id @default(autoincrement())
  interestRate  Float?
  termMonths    Int?
  startDate     DateTime?
  status        LoanStatus @default(PENDING)
  userId        Int
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  loanAmount    Float
  purposeOfLoan String?
  user          User       @relation(fields: [userId], references: [id])
}

model LoanApplication {
  id                  Int               @id @default(autoincrement())
  userId              Int
  employmentDetailId  Int?
  loanType            LoanType
  loanAmount          Float?
  otpVerified         Boolean           @default(false)
  status              LoanStatus        @default(PENDING)
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  attributedPartnerId Int?
  attributionSource   String?
  employmentDetail    EmploymentDetail? @relation("EmploymentLoanApplications", fields: [employmentDetailId], references: [id])
  user                User              @relation(fields: [userId], references: [id])
}

model UserDocument {
  id         Int                  @id @default(autoincrement())
  userId     Int
  docType    DocumentType
  filePath   String
  verified   Boolean              @default(false)
  uploadedAt DateTime             @default(now())
  checksum   String?
  fileName   String?
  fileUrl    String?
  mimeType   String?
  notes      String?
  size       Int?
  status     DocumentUploadStatus @default(SUBMITTED)
  verifiedAt DateTime?
  verifiedBy Int?
  user       User                 @relation(fields: [userId], references: [id])

  @@index([userId, docType])
}

model UserLocation {
  id         Int      @id @default(autoincrement())
  userId     Int
  latitude   Float
  longitude  Float
  accuracy   Float?
  locality   String?
  city       String?
  state      String?
  country    String?
  postalCode String?
  placeName  String?
  capturedAt DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id])
}

model UserDocumentStatus {
  id        Int      @id @default(autoincrement())
  userId    Int      @unique
  status    String   @default("PENDING_UPLOAD")
  latitude  Float?
  longitude Float?
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])
}

enum VerificationStatus {
  PENDING
  VERIFIED
  REJECTED
}

enum UserRole {
  CUSTOMER
  DSA
  AFFILIATE
  ADMIN
  SUPER_ADMIN
  BC
  Employees
}

enum PartnerType {
  DSA
  BC
  AFFILIATE
  API_PARTNER
}

enum PartnerStatusType {
  PENDING
  APPROVED
  REJECTED
  SUSPENDED
}

enum ProfileType {
  INDIVIDUAL
  FIRM
}

enum Gender {
  MALE
  FEMALE
  PREFER_NOT_TO_SAY
}

enum JobStability {
  VERY_UNSTABLE
  SOMEWHAT_UNSTABLE
  NEUTRAL
  STABLE
  VERY_STABLE
}

enum AddressType {
  OWNER_SELF_OR_FAMILY
  RENTED
}

enum LoanStatus {
  PENDING
  APPROVED
  REJECTED
  CLOSED
}

enum EmploymentType {
  SALARIED
  SELF_EMPLOYED
  STUDENT
  UNEMPLOYED
  OTHER
}

enum LoanType {
  MEDICAL_EMERGENCY
  EDUCATION
  HOME_RENOVATION
  DEBT_CONSOLIDATION
  WEDDING
  BUSINESS
  TRAVEL
  OTHER
}

enum DocumentType {
  AADHAAR
  PAN
  PAY_SLIP
  BANK_STATEMENT
  PHOTO
  SIGNATURE
  GST_CERTIFICATE
  TRADE_LICENSE
  COMPANY_PAN
  ADDRESS_PROOF
}

enum DocumentUploadStatus {
  PENDING_UPLOAD
  SUBMITTED
  VERIFIED
  REJECTED
}

enum AttributionType {
  ONLINE_LINK
  ASSISTED
  ORGANIC
  ADMIN_OVERRIDE
}
